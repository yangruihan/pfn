from __future__ import annotations

from stdlib import String, List, Dict, Set, Maybe, Result, Just, Nothing, Ok, Err, Record

from stdlib import reverse, _not_

from bootstrap.Token import *

from bootstrap.AST import *

from dataclasses import dataclass

@dataclass
class ParseError:
    message: str
    token: Token

def parseError(message): return lambda token: Record({"message": message, "token": token})

def errorToString(err):
    return err.message + ' at ' + spanToString(err.token.span)

def spanToString(span):
    return 'line ' + toString(span.line) + ', column ' + toString(span.column)

from dataclasses import dataclass

@dataclass
class ParserState:
    tokens: list[Token]
    pos: int

def initParser(tokens):
    return Record({"tokens": tokens, "pos": 0})

precedence = Dict.fromList([(DOUBLE_PIPE, 1), (DOUBLE_AMP, 2), (EQ, 3), (NEQ, 3), (LT, 3), (LE, 3), (GT, 3), (GE, 3), (DOUBLE_COLON, 4), (DOUBLE_PLUS, 5), (PLUS, 6), (MINUS, 6), (STAR, 7), (SLASH, 7), (PERCENT, 7), (FAT_ARROW, 8)])

def getPrecedence(tt):
    return (lambda __match_val: (__match_val._field0 if isinstance(__match_val, Just) else 0))(Dict.lookup(tt)(precedence))

def current(state):
    return (lambda __match_val: (__match_val._field0 if isinstance(__match_val, Just) else (lambda __match_val: (__match_val._field0 if isinstance(__match_val, Just) else Record({"tokenType": EOF, "value": NoValue, "span": Record({"start": 0, "end": 0, "line": 1, "column": 1})})))(List.last(state.tokens))))(List.getAt(state.pos)(state.tokens))

def peek(state):
    return (lambda __match_val: (__match_val._field0 if isinstance(__match_val, Just) else current(state)))(List.getAt(state.pos + 1)(state.tokens))

def check(state): return lambda types: List.member(current(state).tokenType)(types)

def matchToken(state): return lambda types: (Just(current(state)), Record({**state, "pos": state.pos + 1})) if check(state)(types) else (Nothing, state)

def expect(state): return lambda tt: lambda message: (lambda __let_val_0: (lambda __match_val: (Ok((__match_val._field0, __let_val_0[1])) if isinstance(__match_val, Just) else Err(parseError(message)(current(state)))))(__let_val_0[0]) if isinstance(__let_val_0, tuple) and len(__let_val_0) == 2 else None)(matchToken(state)([tt])) if check(state)([tt]) else Err(parseError(message)(current(state)))

def advance(state):
    return Record({**state, "pos": state.pos + 1})

def getTokenString(token):
    return (lambda __match_val: (__match_val._field0 if isinstance(__match_val, StringValue) else ''))(token.value)

def getTokenInt(token):
    return (lambda __match_val: (__match_val._field0 if isinstance(__match_val, IntValue) else 0))(token.value)

def getTokenFloat(token):
    return (lambda __match_val: (__match_val._field0 if isinstance(__match_val, FloatValue) else 0.0))(token.value)

def getTokenChar(token):
    return (lambda __match_val: (__match_val._field0 if isinstance(__match_val, CharValue) else '\x00'))(token.value)

def parse(tokens):
    return parseModule(initParser(tokens))

def parseModule(state):
    return parseDeclarations(state)([])

def parseDeclarations(state): return lambda decls: Ok(Record({"name": Nothing, "declarations": List.reverse(decls)})) if check(state)([EOF]) else (lambda __match_val: (parseDeclarations(__match_val._field0[1])([__match_val._field0[0]] + decls) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseDeclaration(state))

def parseDeclaration(state):
    return (lambda __let_val_8: (lambda __match_val: (parseDef(__let_val_8[1])(False)(Nothing) if isinstance(__match_val, Just) else (lambda __let_val_7: (lambda __match_val: (parseTypeDecl(__let_val_7[1]) if isinstance(__match_val, Just) else (lambda __let_val_6: (lambda __match_val: (parseGadtDecl(__let_val_6[1]) if isinstance(__match_val, Just) else (lambda __let_val_5: (lambda __match_val: (parseImportDecl(__let_val_5[1]) if isinstance(__match_val, Just) else (lambda __let_val_4: (lambda __match_val: (parseInterfaceDecl(__let_val_4[1]) if isinstance(__match_val, Just) else (lambda __let_val_3: (lambda __match_val: (parseImplDecl(__let_val_3[1]) if isinstance(__match_val, Just) else (lambda __let_val_2: (lambda __match_val: (parseEffectDecl(__let_val_2[1]) if isinstance(__match_val, Just) else (lambda __let_val_1: (lambda __match_val: (parseDecorator(__let_val_1[1]) if isinstance(__match_val, Just) else Err(parseError('Unexpected token: ' + tokenTypeName(current(state).tokenType))(current(state)))))(__let_val_1[0]) if isinstance(__let_val_1, tuple) and len(__let_val_1) == 2 else None)(matchToken(state)([AT]))))(__let_val_2[0]) if isinstance(__let_val_2, tuple) and len(__let_val_2) == 2 else None)(matchToken(state)([KW_EFFECT]))))(__let_val_3[0]) if isinstance(__let_val_3, tuple) and len(__let_val_3) == 2 else None)(matchToken(state)([KW_IMPL]))))(__let_val_4[0]) if isinstance(__let_val_4, tuple) and len(__let_val_4) == 2 else None)(matchToken(state)([KW_INTERFACE]))))(__let_val_5[0]) if isinstance(__let_val_5, tuple) and len(__let_val_5) == 2 else None)(matchToken(state)([KW_IMPORT]))))(__let_val_6[0]) if isinstance(__let_val_6, tuple) and len(__let_val_6) == 2 else None)(matchToken(state)([KW_GADT]))))(__let_val_7[0]) if isinstance(__let_val_7, tuple) and len(__let_val_7) == 2 else None)(matchToken(state)([KW_TYPE]))))(__let_val_8[0]) if isinstance(__let_val_8, tuple) and len(__let_val_8) == 2 else None)(matchToken(state)([KW_DEF]))

def parseDecorator(state):
    return (lambda s1: (lambda s2: (lambda s3: (lambda __let_val_9: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: ((lambda exportName: parseDef(__match_val._field0[1])(True)(Just(exportName)))(getTokenString(__match_val._field0[0])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (parseDef(__match_val._field0[1])(True)(Nothing) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(expect(s3)(KW_DEF)("Expected 'def' after @py.export")))))))(expect(__match_val._field0[1])(KW_DEF)("Expected 'def' after @py.export")))(expect(__match_val._field0[1])(RPAREN)("Expected ')'")))(expect(__let_val_9[1])(STRING)('Expected export name')))(__let_val_9[0]) if isinstance(__let_val_9, tuple) and len(__let_val_9) == 2 else None)(matchToken(s3)([LPAREN])))(advance(s2)) if check(s2)([IDENT]) and getTokenString(current(s2)) == 'export' else Err(parseError("Expected 'export' after '@py.'")(current(s2))))(advance(s1)) if check(s1)([DOT]) else Err(parseError("Expected '.' after '@py'")(current(s1))))(advance(state)) if check(state)([IDENT]) and getTokenString(current(state)) == 'py' else Err(parseError("Expected 'py' after '@'")(current(state)))

def parseDef(state): return lambda isExported: lambda exportName: (lambda __match_val: (lambda name: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((DefDecl(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0], "returnType": __match_val._field0[0], "isExported": isExported, "exportName": exportName})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(EQUALS)("Expected '=' after function signature")))(parseReturnType(__match_val._field0[1])))(parseParams(__match_val._field0[1])))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected function name'))

def parseParams(state):
    return (lambda __let_val_10: (lambda __match_val: (Ok(([], advance(__let_val_10[1]))) if check(__let_val_10[1])([RPAREN]) else parseParamList(__let_val_10[1])([]) if isinstance(__match_val, Just) else Ok(([], state))))(__let_val_10[0]) if isinstance(__let_val_10, tuple) and len(__let_val_10) == 2 else None)(matchToken(state)([LPAREN]))

def parseParamList(state): return lambda params: (lambda __match_val: (lambda __let_val_11: (lambda __match_val: (parseParamList(__let_val_11[1])(params + [__match_val._field0[0]]) if isinstance(__match_val, Just) else (lambda __match_val: (Ok((params + [__match_val._field0[0]], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(expect(__match_val._field0[1])(RPAREN)("Expected ')' after parameters"))))(__let_val_11[0]) if isinstance(__let_val_11, tuple) and len(__let_val_11) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parseParam(state))

def parseParam(state):
    return (lambda __match_val: (lambda name: (lambda __let_val_12: (lambda __match_val: (lambda __match_val: (Ok((Record({"name": name, "typeAnnotation": Just(__match_val._field0[0])}), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Ok((Record({"name": name, "typeAnnotation": Nothing}), __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0)))))(parseTypeRef(__let_val_12[1])))(__let_val_12[0]) if isinstance(__let_val_12, tuple) and len(__let_val_12) == 2 else None)(matchToken(__match_val._field0[1])([COLON])))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected parameter name'))

def parseReturnType(state):
    return (lambda __let_val_13: (lambda __match_val: (lambda __match_val: (Ok((Just(__match_val._field0[0]), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((Nothing, state)))))(parseTypeRef(__let_val_13[1])))(__let_val_13[0]) if isinstance(__let_val_13, tuple) and len(__let_val_13) == 2 else None)(matchToken(state)([ARROW]))

def parseTypeDecl(state):
    return (lambda __match_val: (lambda name: (lambda __match_val: (lambda __let_val_14: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((TypeDecl(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "constructors": [], "isRecord": True, "recordFields": __match_val._field0.fields, "isGadt": False})), __match_val._field0[1])) if isinstance(__match_val, RecordTypeRef) else (lambda __match_val: (Ok((TypeDecl(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "constructors": __match_val._field0[0], "isRecord": False, "recordFields": [], "isGadt": False})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (Ok((TypeDecl(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "constructors": __match_val._field0[0], "isRecord": False, "recordFields": [], "isGadt": False})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))(parseConstructors(__match_val._field0[1])([]))))))(parseConstructors(__let_val_14[1])([]))))(__match_val._field0[0]))(parseTypeRef(__let_val_14[1])))(__let_val_14[0]) if isinstance(__let_val_14, tuple) and len(__let_val_14) == 2 else None)(matchToken(__match_val._field0[1])([EQUALS])))(parseTypeParams(__match_val._field0[1])))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected type name'))

def parseTypeParams(state):
    return parseTypeParamsLoop(state)([])

def parseTypeParamsLoop(state): return lambda params: (lambda peekTok: (lambda name: parseTypeParamsLoop(advance(state))(params + [name]))(getTokenString(current(state))) if List.member(peekTok.tokenType)([EQUALS, PIPE, EOF]) else Ok((params, state)))(peek(state)) if check(state)([IDENT]) else Ok((params, state))

def parseConstructors(state): return lambda ctors: (lambda __let_val_15: (lambda __match_val: (lambda __match_val: (lambda name: (lambda __match_val: (parseConstructors(__match_val._field0[1])(ctors + [Record({"name": name, "__match_val._field0[0]": __match_val._field0[0]})]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((ctors, state))))))(parseConstructorFields(__match_val._field0[1])([])))(getTokenString(__match_val._field0[0])))(expect(__let_val_15[1])(IDENT)('Expected constructor name')))(__let_val_15[0]) if isinstance(__let_val_15, tuple) and len(__let_val_15) == 2 else None)(matchToken(state)([PIPE]))

def parseConstructorFields(state): return lambda fields: (lambda __match_val: (parseConstructorFields(__match_val._field0[1])(fields + [__match_val._field0[0]]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseTypeAtom(state)) if check(state)([IDENT]) and _not_(check(state)([PIPE, EOF])) else Ok((fields, state))

def parseGadtDecl(state):
    return (lambda __match_val: (lambda name: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((TypeDecl(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "constructors": __match_val._field0[0], "isRecord": False, "recordFields": [], "isGadt": True})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))))))(expect(__match_val._field0[1])(RBRACE)("Expected '}'")))(parseGadtConstructors(__match_val._field0[1])([])))(expect(__match_val._field0[1])(LBRACE)("Expected '{'")))(expect(__match_val._field0[1])(KW_WHERE)("Expected 'where'")))(parseTypeParams(__match_val._field0[1])))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected type name'))

def parseGadtConstructors(state): return lambda ctors: Ok((ctors, state)) if check(state)([RBRACE]) else (lambda __match_val: (lambda name: (lambda __match_val: ((lambda __let_val_16: parseGadtConstructors(__let_val_16[1])(ctors + [Record({"name": name, "__match_val._field0[0]": __match_val._field0[0]})]) if isinstance(__let_val_16, tuple) and len(__let_val_16) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseGadtFields(__match_val._field0[1])([])))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected constructor name'))

def parseGadtFields(state): return lambda fields: (lambda __match_val: (parseGadtFields(__match_val._field0[1])(fields + [__match_val._field0[0]]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseTypeRef(state)) if check(state)([IDENT]) else Ok((fields, state))

def parseImportDecl(state):
    return (lambda isPython: (lambda s1: (lambda __match_val: (lambda firstPartName: (lambda __match_val: (lambda moduleName: (lambda __let_val_17: (lambda __match_val: (lambda __match_val: (Ok((ImportDecl(Record({"module": moduleName, "alias": Just(getTokenString(__match_val._field0[0])), "exposing": Nothing, "isPython": isPython})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Ok((ImportDecl(Record({"module": moduleName, "alias": Nothing, "exposing": Nothing, "isPython": isPython})), __let_val_17[1])) if __match_val is Nothing else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))))(expect(__let_val_17[1])(IDENT)('Expected alias')))(__let_val_17[0]) if isinstance(__let_val_17, tuple) and len(__let_val_17) == 2 else None)(matchToken(__match_val._field0[1])([KW_AS])))(String.join('.')(__match_val._field0[0])))(parseModulePath(__match_val._field0[1])([firstPartName])))(getTokenString(__match_val._field0[0])))(expect(s1)(IDENT)('Expected module name')))(advance(state) if isPython else state))(check(state)([IDENT]) and getTokenString(current(state)) == 'python')

def parseModulePath(state): return lambda parts: (lambda __let_val_18: (lambda __match_val: (lambda __match_val: (parseModulePath(__match_val._field0[1])(parts + [getTokenString(__match_val._field0[0])]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((parts, state)))))(expect(__let_val_18[1])(IDENT)('Expected module part')))(__let_val_18[0]) if isinstance(__let_val_18, tuple) and len(__let_val_18) == 2 else None)(matchToken(state)([DOT]))

def parseInterfaceDecl(state):
    return (lambda __match_val: (lambda name: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((InterfaceDecl(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0], "superclasses": []})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))))))(expect(__match_val._field0[1])(RBRACE)("Expected '}'")))(parseInterfaceMethods(__match_val._field0[1])([])))(expect(__match_val._field0[1])(LBRACE)("Expected '{'")))(expect(__match_val._field0[1])(KW_WHERE)("Expected 'where'")))(parseTypeParams(__match_val._field0[1])))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected interface name'))

def parseInterfaceMethods(state): return lambda methods: Ok((methods, state)) if check(state)([RBRACE]) else (lambda __match_val: (lambda __match_val: (lambda __match_val: ((lambda __let_val_19: parseInterfaceMethods(__let_val_19[1])(methods + [Record({"name": getTokenString(__match_val._field0[0]), "typ": __match_val._field0[0]})]) if isinstance(__let_val_19, tuple) and len(__let_val_19) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))(parseTypeRef(__match_val._field0[1])))(expect(__match_val._field0[1])(COLON)("Expected ':'")))(expect(state)(IDENT)('Expected method name'))

def parseImplDecl(state):
    return (lambda __match_val: (lambda className: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((ImplDecl(Record({"className": className, "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))))))(expect(__match_val._field0[1])(RBRACE)("Expected '}'")))(parseImplMethods(__match_val._field0[1])([])))(expect(__match_val._field0[1])(LBRACE)("Expected '{'")))(expect(__match_val._field0[1])(KW_WHERE)("Expected 'where'")))(parseTypeRef(__match_val._field0[1])))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected class name'))

def parseImplMethods(state): return lambda methods: Ok((methods, state)) if check(state)([RBRACE]) else (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: ((lambda __let_val_20: parseImplMethods(__let_val_20[1])(methods + [Record({"name": getTokenString(__match_val._field0[0]), "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})]) if isinstance(__let_val_20, tuple) and len(__let_val_20) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(EQUALS)("Expected '='")))(parseParams(__match_val._field0[1])))(expect(state)(IDENT)('Expected method name'))

def parseEffectDecl(state):
    return (lambda __match_val: (lambda name: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((EffectDecl(Record({"name": name, "operations": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))))(expect(__match_val._field0[1])(RBRACE)("Expected '}'")))(parseEffectOps(__match_val._field0[1])([])))(expect(__match_val._field0[1])(LBRACE)("Expected '{'")))(getTokenString(__match_val._field0[0])))(expect(state)(IDENT)('Expected effect name'))

def parseEffectOps(state): return lambda ops: Ok((ops, state)) if check(state)([RBRACE]) else (lambda __match_val: (lambda __match_val: (lambda __match_val: ((lambda __let_val_21: parseEffectOps(__let_val_21[1])(ops + [Record({"name": getTokenString(__match_val._field0[0]), "typ": __match_val._field0[0]})]) if isinstance(__let_val_21, tuple) and len(__let_val_21) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))(parseTypeRef(__match_val._field0[1])))(expect(__match_val._field0[1])(COLON)("Expected ':'")))(expect(state)(IDENT)('Expected operation name'))

def parseTypeRef(state):
    return parseTypeArrow(state)

def parseTypeArrow(state):
    return (lambda __match_val: (lambda __let_val_22: (lambda __match_val: (lambda __match_val: (Ok((FunTypeRef(Record({"param": __match_val._field0[0], "result": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Ok((__match_val._field0[0], __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0)))))(parseTypeArrow(__let_val_22[1])))(__let_val_22[0]) if isinstance(__let_val_22, tuple) and len(__let_val_22) == 2 else None)(matchToken(__match_val._field0[1])([ARROW])))(parseTypeApp(state))

def parseTypeApp(state):
    return (lambda __match_val: (lambda __match_val: Ok((__match_val._field0[0], __match_val._field0[1])) if List.isEmpty(__match_val._field0[0]) else (lambda __match_val: (Ok((SimpleTypeRef(Record({"name": __match_val._field0.name, "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, SimpleTypeRef) else Ok((__match_val._field0[0], __match_val._field0[1]))))(__match_val._field0[0]))(parseTypeArgs(__match_val._field0[1])([])))(parseTypeAtom(state))

def parseTypeArgs(state): return lambda args: (lambda __match_val: (parseTypeArgs(__match_val._field0[1])(args + [__match_val._field0[0]]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseTypeAtom(state)) if check(state)([IDENT]) else Ok((args, state))

def parseTypeAtom(state):
    return (lambda __let_val_26: (lambda __match_val: Ok((TupleTypeRef(Record({"elements": []})), advance(__let_val_26[1]))) if check(__let_val_26[1])([RPAREN]) else (lambda __match_val: (lambda __let_val_25: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((TupleTypeRef(Record({"__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __let_val_24: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((SimpleTypeRef(Record({"name": 'List', "args": [__match_val._field0[0]]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __let_val_23: (lambda __match_val: (parseRecordType(__let_val_23[1]) if isinstance(__match_val, Just) else (lambda __match_val: (Ok((SimpleTypeRef(Record({"name": getTokenString(__match_val._field0[0]), "args": []})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(expect(state)(IDENT)('Expected type name'))))(__let_val_23[0]) if isinstance(__let_val_23, tuple) and len(__let_val_23) == 2 else None)(matchToken(state)([LBRACE]))))))(expect(__match_val._field0[1])(RBRACKET)("Expected ']' after list type")))(parseTypeRef(__let_val_24[1])))(__let_val_24[0]) if isinstance(__let_val_24, tuple) and len(__let_val_24) == 2 else None)(matchToken(state)([LBRACKET]))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')'"))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')' after tuple type")))(parseTupleTypes(__let_val_25[1])([__match_val._field0[0]])))(__let_val_25[0]) if isinstance(__let_val_25, tuple) and len(__let_val_25) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parseTypeRef(__let_val_26[1])))(__let_val_26[0]) if isinstance(__let_val_26, tuple) and len(__let_val_26) == 2 else None)(matchToken(state)([LPAREN]))

def parseTupleTypes(state): return lambda elements: Ok((elements, state)) if check(state)([RPAREN]) else (lambda __match_val: ((lambda __let_val_27: parseTupleTypes(__let_val_27[1])(elements + [__match_val._field0[0]]) if isinstance(__let_val_27, tuple) and len(__let_val_27) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseTypeRef(state))

def parseRecordType(state):
    return (lambda __match_val: (Ok((RecordTypeRef(Record({"fields": []})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(expect(state)(RBRACE)("Expected '}' after record type")) if check(state)([RBRACE]) else (lambda __match_val: (lambda __match_val: (Ok((RecordTypeRef(Record({"__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(expect(__match_val._field0[1])(RBRACE)("Expected '}' after record type")))(parseRecordFields(state)([]))

def parseRecordFields(state): return lambda fields: (lambda __match_val: (lambda __match_val: (lambda __match_val: ((lambda __let_val_28: Ok((fields + [(getTokenString(__match_val._field0[0]), __match_val._field0[0])], __let_val_28[1])) if check(__let_val_28[1])([RBRACE]) else parseRecordFields(__let_val_28[1])(fields + [(getTokenString(__match_val._field0[0]), __match_val._field0[0])]) if isinstance(__let_val_28, tuple) and len(__let_val_28) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))(parseTypeRef(__match_val._field0[1])))(expect(__match_val._field0[1])(COLON)("Expected ':' after field name")))(expect(state)(IDENT)('Expected field name'))

def parseExpr(state):
    return parseLet(state)

def parseLet(state):
    return (lambda __let_val_30: (lambda __match_val: (lambda __match_val: (lambda name: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __let_val_29: (lambda __match_val: (Ok((Let(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if List.isEmpty(__match_val._field0[0]) else Ok((LetFunc(Record({"name": name, "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else parseDo(state))))))))(parseExpr(__let_val_29[1])) if isinstance(__let_val_29, tuple) and len(__let_val_29) == 2 else None)(matchToken(__match_val._field0[1])([KW_IN])))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(EQUALS)("Expected '=' after let binding")))(parseLetParams(__match_val._field0[1])([])))(getTokenString(__match_val._field0[0])))(expect(__let_val_30[1])(IDENT)('Expected variable name')))(__let_val_30[0]) if isinstance(__let_val_30, tuple) and len(__let_val_30) == 2 else None)(matchToken(state)([KW_LET]))

def parseLetParams(state): return lambda params: (lambda __let_val_31: (lambda __match_val: (lambda __match_val: (lambda __match_val: (parseLetParams(__match_val._field0[1])(params + [__match_val._field0[0]]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (parseLetParams(__match_val._field0[1])(params + [__match_val._field0[0]]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseParam(state))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')'")))(parseParam(__let_val_31[1])))(__let_val_31[0]) if isinstance(__let_val_31, tuple) and len(__let_val_31) == 2 else None)(matchToken(state)([LPAREN])) if check(state)([IDENT, LPAREN]) else Ok((params, state))

def parseDo(state):
    return (lambda __let_val_33: (lambda __match_val: (lambda __match_val: (lambda __let_val_32: (lambda __match_val: (Ok((DoNotation(Record({"__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else parseIf(state)))))(parseExpr(__let_val_32[1])) if isinstance(__let_val_32, tuple) and len(__let_val_32) == 2 else None)(matchToken(__match_val._field0[1])([KW_IN])))(parseDoBindings(__let_val_33[1])([])))(__let_val_33[0]) if isinstance(__let_val_33, tuple) and len(__let_val_33) == 2 else None)(matchToken(state)([KW_DO]))

def parseDoBindings(state): return lambda bindings: Ok((bindings, state)) if check(state)([KW_IN]) else (lambda __match_val: (lambda __let_val_34: (lambda __match_val: (parseDoBindings(__match_val._field0[1])(bindings + [Record({"name": getTokenString(__match_val._field0[0]), "__match_val._field0[0]": __match_val._field0[0]})]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseExpr(__let_val_34[1])) if isinstance(__let_val_34, tuple) and len(__let_val_34) == 2 else None)(matchToken(__match_val._field0[1])([LEFT_ARROW])))(expect(state)(IDENT)('Expected variable name in do binding'))

def parseIf(state):
    return (lambda __let_val_35: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((If(Record({"__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else parseMatch(state))))))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(KW_ELSE)("Expected 'else'")))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(KW_THEN)("Expected 'then'")))(parseExpr(__let_val_35[1])))(__let_val_35[0]) if isinstance(__let_val_35, tuple) and len(__let_val_35) == 2 else None)(matchToken(state)([KW_IF]))

def parseMatch(state):
    return (lambda __let_val_36: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((Match(Record({"__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else parseOr(state))))))(parseMatchCases(__match_val._field0[1])([])))(expect(__match_val._field0[1])(KW_WITH)("Expected 'with'")))(parseExpr(__let_val_36[1])))(__let_val_36[0]) if isinstance(__let_val_36, tuple) and len(__let_val_36) == 2 else None)(matchToken(state)([KW_MATCH]))

def parseMatchCases(state): return lambda cases: (lambda __let_val_38: (lambda __match_val: (lambda __match_val: (lambda __let_val_37: (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (parseMatchCases(__match_val._field0[1])(cases + [Record({"__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": Just(__match_val._field0[0])})]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (lambda __match_val: (parseMatchCases(__match_val._field0[1])(cases + [Record({"__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": Nothing})]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((cases, state)))))))(parseExpr(__match_val._field0[1])))(expect(__let_val_37[1])(ARROW)("Expected '->'")))))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(ARROW)("Expected '->'")))(parseExpr(__let_val_37[1])))(__let_val_37[0]) if isinstance(__let_val_37, tuple) and len(__let_val_37) == 2 else None)(matchToken(__match_val._field0[1])([KW_IF])))(parsePattern(__let_val_38[1])))(__let_val_38[0]) if isinstance(__let_val_38, tuple) and len(__let_val_38) == 2 else None)(matchToken(state)([PIPE]))

def parseOr(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseOrLoop(__match_val._field0[1])(__match_val._field0[0])))(parseAnd(state))

def parseOrLoop(state): return lambda left: (lambda __let_val_39: (lambda __match_val: (lambda __match_val: (parseOrLoop(__match_val._field0[1])(BinOp(Record({"left": left, "op": '||', "__match_val._field0[0]": __match_val._field0[0]}))) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((left, state)))))(parseAnd(__let_val_39[1])))(__let_val_39[0]) if isinstance(__let_val_39, tuple) and len(__let_val_39) == 2 else None)(matchToken(state)([DOUBLE_PIPE]))

def parseAnd(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseAndLoop(__match_val._field0[1])(__match_val._field0[0])))(parseComparison(state))

def parseAndLoop(state): return lambda left: (lambda __let_val_40: (lambda __match_val: (lambda __match_val: (parseAndLoop(__match_val._field0[1])(BinOp(Record({"left": left, "op": '&&', "__match_val._field0[0]": __match_val._field0[0]}))) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((left, state)))))(parseComparison(__let_val_40[1])))(__let_val_40[0]) if isinstance(__let_val_40, tuple) and len(__let_val_40) == 2 else None)(matchToken(state)([DOUBLE_AMP]))

def parseComparison(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseComparisonLoop(__match_val._field0[1])(__match_val._field0[0])))(parseCons(state))

def parseComparisonLoop(state): return lambda left: (lambda __let_val_41: (lambda __match_val: (lambda __match_val: ((lambda op: parseComparisonLoop(__match_val._field0[1])(BinOp(Record({"left": left, "op": op, "__match_val._field0[0]": __match_val._field0[0]}))))(getTokenString(__match_val._field0)) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((left, state)))))(parseCons(__let_val_41[1])))(__let_val_41[0]) if isinstance(__let_val_41, tuple) and len(__let_val_41) == 2 else None)(matchToken(state)([EQ, NEQ, LT, LE, GT, GE]))

def parseCons(state):
    return (lambda __match_val: (lambda __let_val_42: (lambda __match_val: (lambda __match_val: (Ok((BinOp(Record({"__match_val._field0[0]": __match_val._field0[0], "op": '::', "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Ok((__match_val._field0[0], __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0)))))(parseCons(__let_val_42[1])))(__let_val_42[0]) if isinstance(__let_val_42, tuple) and len(__let_val_42) == 2 else None)(matchToken(__match_val._field0[1])([DOUBLE_COLON])))(parseConcat(state))

def parseConcat(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseConcatLoop(__match_val._field0[1])(__match_val._field0[0])))(parseAdditive(state))

def parseConcatLoop(state): return lambda left: (lambda __let_val_43: (lambda __match_val: (lambda __match_val: (parseConcatLoop(__match_val._field0[1])(BinOp(Record({"left": left, "op": '++', "__match_val._field0[0]": __match_val._field0[0]}))) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((left, state)))))(parseAdditive(__let_val_43[1])))(__let_val_43[0]) if isinstance(__let_val_43, tuple) and len(__let_val_43) == 2 else None)(matchToken(state)([DOUBLE_PLUS]))

def parseAdditive(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseAdditiveLoop(__match_val._field0[1])(__match_val._field0[0])))(parseMultiplicative(state))

def parseAdditiveLoop(state): return lambda left: (lambda __let_val_44: (lambda __match_val: (lambda __match_val: ((lambda op: parseAdditiveLoop(__match_val._field0[1])(BinOp(Record({"left": left, "op": op, "__match_val._field0[0]": __match_val._field0[0]}))))(getTokenString(__match_val._field0)) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((left, state)))))(parseMultiplicative(__let_val_44[1])))(__let_val_44[0]) if isinstance(__let_val_44, tuple) and len(__let_val_44) == 2 else None)(matchToken(state)([PLUS, MINUS]))

def parseMultiplicative(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseMultiplicativeLoop(__match_val._field0[1])(__match_val._field0[0])))(parseUnary(state))

def parseMultiplicativeLoop(state): return lambda left: (lambda __let_val_45: (lambda __match_val: (lambda __match_val: ((lambda op: parseMultiplicativeLoop(__match_val._field0[1])(BinOp(Record({"left": left, "op": op, "__match_val._field0[0]": __match_val._field0[0]}))))(getTokenString(__match_val._field0)) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((left, state)))))(parseUnary(__let_val_45[1])))(__let_val_45[0]) if isinstance(__let_val_45, tuple) and len(__let_val_45) == 2 else None)(matchToken(state)([STAR, SLASH, PERCENT]))

def parseUnary(state):
    return (lambda __let_val_46: (lambda __match_val: (lambda __match_val: ((lambda op: Ok((UnaryOp(Record({"op": op, "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])))(getTokenString(__match_val._field0)) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else parseApplication(state))))(parseUnary(__let_val_46[1])))(__let_val_46[0]) if isinstance(__let_val_46, tuple) and len(__let_val_46) == 2 else None)(matchToken(state)([MINUS, BANG]))

def parseApplication(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseApplicationLoop(__match_val._field0[1])(__match_val._field0[0])))(parseAccess(state))

def parseApplicationLoop(state): return lambda expr: (lambda __let_val_47: (lambda __match_val: parseApplicationLoop(advance(__let_val_47[1]))(expr) if check(__let_val_47[1])([RPAREN]) else (lambda __match_val: (lambda __match_val: ((lambda applied: parseApplicationLoop(__match_val._field0[1])(applied))(applyArgs(expr)(__match_val._field0[0])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((expr, state))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')'")))(parseAppArgs(__let_val_47[1])([])))(__let_val_47[0]) if isinstance(__let_val_47, tuple) and len(__let_val_47) == 2 else None)(matchToken(state)([LPAREN]))

def parseAppArgs(state): return lambda args: (lambda __match_val: (lambda __let_val_48: (lambda __match_val: (parseAppArgs(__let_val_48[1])(args + [__match_val._field0[0]]) if isinstance(__match_val, Just) else (Ok((args + [__match_val._field0[0]], __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0))))(__let_val_48[0]) if isinstance(__let_val_48, tuple) and len(__let_val_48) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parseExpr(state))

def applyArgs(func): return lambda args: (lambda __match_val: (func if __match_val == [] else (App(Record({"func": func, "args": [__match_val[0]]})) if isinstance(__match_val, list) and len(__match_val) == 1 else applyArgs(App(Record({"func": func, "args": [__match_val[0]]})))(rest))))(args)

def parseAccess(state):
    return (lambda __match_val: (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseAccessLoop(__match_val._field0[1])(__match_val._field0[0])))(parseAtom(state))

def parseAccessLoop(state): return lambda expr: (lambda __let_val_50: (lambda __match_val: (lambda __match_val: (parseAccessLoop(__match_val._field0[1])(FieldAccess(Record({"expr": expr, "field": getTokenString(__match_val._field0[0])}))) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __let_val_49: (lambda __match_val: (lambda __match_val: (lambda __match_val: (parseAccessLoop(__match_val._field0[1])(IndexAccess(Record({"expr": expr, "__match_val._field0[0]": __match_val._field0[0]}))) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Ok((expr, state))))))(expect(__match_val._field0[1])(RBRACKET)("Expected ']'")))(parseExpr(__let_val_49[1])))(__let_val_49[0]) if isinstance(__let_val_49, tuple) and len(__let_val_49) == 2 else None)(matchToken(state)([LBRACKET])))))(expect(__let_val_50[1])(IDENT)('Expected field name')))(__let_val_50[0]) if isinstance(__let_val_50, tuple) and len(__let_val_50) == 2 else None)(matchToken(state)([DOT]))

def parseAtom(state):
    return (lambda __let_val_61: (lambda __match_val: (Ok((IntLit(getTokenInt(__match_val._field0)), __let_val_61[1])) if isinstance(__match_val, Just) else (lambda __let_val_60: (lambda __match_val: (Ok((FloatLit(getTokenFloat(__match_val._field0)), __let_val_60[1])) if isinstance(__match_val, Just) else (lambda __let_val_59: (lambda __match_val: (Ok((StringLit(getTokenString(__match_val._field0)), __let_val_59[1])) if isinstance(__match_val, Just) else (lambda __let_val_58: (lambda __match_val: (Ok((CharLit(getTokenChar(__match_val._field0)), __let_val_58[1])) if isinstance(__match_val, Just) else (lambda __let_val_57: (lambda __match_val: (Ok((BoolLit(True), __let_val_57[1])) if isinstance(__match_val, Just) else (lambda __let_val_56: (lambda __match_val: (Ok((BoolLit(False), __let_val_56[1])) if isinstance(__match_val, Just) else (lambda __let_val_55: (lambda __match_val: (parseLambda(__let_val_55[1]) if isinstance(__match_val, Just) else (lambda __let_val_54: (lambda __match_val: Ok((UnitLit, advance(__let_val_54[1]))) if check(__let_val_54[1])([RPAREN]) else (lambda __match_val: (lambda __let_val_53: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((TupleLit(__match_val._field0[0]), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __let_val_52: (lambda __match_val: Ok((ListLit([]), advance(__let_val_52[1]))) if check(__let_val_52[1])([RBRACKET]) else (lambda __match_val: (lambda __match_val: (Ok((ListLit(__match_val._field0[0]), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __let_val_51: (lambda __match_val: (parseRecord(__let_val_51[1]) if isinstance(__match_val, Just) else (lambda __match_val: (Ok((Var(getTokenString(__match_val._field0[0])), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(expect(state)(IDENT)('Unexpected token'))))(__let_val_51[0]) if isinstance(__let_val_51, tuple) and len(__let_val_51) == 2 else None)(matchToken(state)([LBRACE]))))))(expect(__match_val._field0[1])(RBRACKET)("Expected ']'")))(parseListElements(__let_val_52[1])([])))(__let_val_52[0]) if isinstance(__let_val_52, tuple) and len(__let_val_52) == 2 else None)(matchToken(state)([LBRACKET]))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')'"))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')'")))(parseTupleElements(__let_val_53[1])([__match_val._field0[0]])))(__let_val_53[0]) if isinstance(__let_val_53, tuple) and len(__let_val_53) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parseExpr(__let_val_54[1])))(__let_val_54[0]) if isinstance(__let_val_54, tuple) and len(__let_val_54) == 2 else None)(matchToken(state)([LPAREN]))))(__let_val_55[0]) if isinstance(__let_val_55, tuple) and len(__let_val_55) == 2 else None)(matchToken(state)([KW_FN]))))(__let_val_56[0]) if isinstance(__let_val_56, tuple) and len(__let_val_56) == 2 else None)(matchToken(state)([FALSE]))))(__let_val_57[0]) if isinstance(__let_val_57, tuple) and len(__let_val_57) == 2 else None)(matchToken(state)([TRUE]))))(__let_val_58[0]) if isinstance(__let_val_58, tuple) and len(__let_val_58) == 2 else None)(matchToken(state)([CHAR]))))(__let_val_59[0]) if isinstance(__let_val_59, tuple) and len(__let_val_59) == 2 else None)(matchToken(state)([STRING]))))(__let_val_60[0]) if isinstance(__let_val_60, tuple) and len(__let_val_60) == 2 else None)(matchToken(state)([FLOAT]))))(__let_val_61[0]) if isinstance(__let_val_61, tuple) and len(__let_val_61) == 2 else None)(matchToken(state)([INT]))

def parseLambda(state):
    return (lambda __let_val_62: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((Lambda(Record({"params": [], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(parseExpr(__match_val._field0[1])))(expect(advance(__let_val_62[1]))(FAT_ARROW)("Expected '=>'")) if check(__let_val_62[1])([RPAREN]) else (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((Lambda(Record({"__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((Lambda(Record({"__match_val._field0[0]": __match_val._field0[0], "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(FAT_ARROW)("Expected '=>'")))(parseLambdaParamsNoParens(state)([]))))))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(FAT_ARROW)("Expected '=>'")))(expect(__match_val._field0[1])(RPAREN)("Expected ')'")))(parseLambdaParams(__let_val_62[1])([])))(__let_val_62[0]) if isinstance(__let_val_62, tuple) and len(__let_val_62) == 2 else None)(matchToken(state)([LPAREN]))

def parseLambdaParams(state): return lambda params: (lambda __match_val: (lambda __let_val_63: (lambda __match_val: (parseLambdaParams(__let_val_63[1])(params + [__match_val._field0[0]]) if isinstance(__match_val, Just) else (Ok((params + [__match_val._field0[0]], __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0))))(__let_val_63[0]) if isinstance(__let_val_63, tuple) and len(__let_val_63) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parseParam(state))

def parseLambdaParamsNoParens(state): return lambda params: (lambda peekTok: (lambda __match_val: (parseLambdaParamsNoParens(__match_val._field0[1])(params + [__match_val._field0[0]]) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseParam(state)) if List.member(peekTok.tokenType)([IDENT, FAT_ARROW, COLON, LPAREN]) else Ok((params, state)))(peek(state)) if check(state)([IDENT]) else Ok((params, state))

def parseTupleElements(state): return lambda elements: Ok((elements, state)) if check(state)([RPAREN]) else (lambda __match_val: ((lambda __let_val_64: parseTupleElements(__let_val_64[1])(elements + [__match_val._field0[0]]) if isinstance(__let_val_64, tuple) and len(__let_val_64) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parseExpr(state))

def parseListElements(state): return lambda elements: (lambda __match_val: (lambda __let_val_65: (lambda __match_val: (parseListElements(__let_val_65[1])(elements + [__match_val._field0[0]]) if isinstance(__match_val, Just) else (Ok((elements + [__match_val._field0[0]], __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0))))(__let_val_65[0]) if isinstance(__let_val_65, tuple) and len(__let_val_65) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parseExpr(state))

def parseRecord(state):
    return (lambda __match_val: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((RecordUpdate(Record({"record": Var(getTokenString(__match_val._field0[0])), "__match_val._field0[0]": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))))(expect(__match_val._field0[1])(RBRACE)("Expected '}'")))(parseRecordUpdates(__match_val._field0[1])([])))(expect(__match_val._field0[1])(KW_WITH)("Expected 'with'")))(expect(state)(IDENT)('Expected record name')) if check(state)([IDENT]) and peek(state).tokenType == KW_WITH else Ok((RecordLit([]), advance(state))) if check(state)([RBRACE]) else (lambda __match_val: (lambda __match_val: (Ok((RecordLit(__match_val._field0[0]), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0))))(expect(__match_val._field0[1])(RBRACE)("Expected '}'")))(parseRecordFieldsExpr(state)([]))

def parseRecordFieldsExpr(state): return lambda fields: (lambda __match_val: (lambda __match_val: (lambda __match_val: ((lambda __let_val_66: Ok((fields + [Record({"name": getTokenString(__match_val._field0[0]), "__match_val._field0[0]": __match_val._field0[0]})], __let_val_66[1])) if check(__let_val_66[1])([RBRACE]) else parseRecordFieldsExpr(__let_val_66[1])(fields + [Record({"name": getTokenString(__match_val._field0[0]), "__match_val._field0[0]": __match_val._field0[0]})]) if isinstance(__let_val_66, tuple) and len(__let_val_66) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(COLON)("Expected ':'")))(expect(state)(IDENT)('Expected field name'))

def parseRecordUpdates(state): return lambda updates: Ok((updates, state)) if check(state)([RBRACE]) else (lambda __match_val: (lambda __match_val: (lambda __match_val: ((lambda __let_val_67: parseRecordUpdates(__let_val_67[1])(updates + [Record({"name": getTokenString(__match_val._field0[0]), "__match_val._field0[0]": __match_val._field0[0]})]) if isinstance(__let_val_67, tuple) and len(__let_val_67) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else Err(__match_val._field0)))))(parseExpr(__match_val._field0[1])))(expect(__match_val._field0[1])(EQUALS)("Expected '='")))(expect(state)(IDENT)('Expected field name'))

def parsePattern(state):
    return parseConsPattern(state)

def parseConsPattern(state):
    return (lambda __match_val: (lambda __let_val_68: (lambda __match_val: (lambda __match_val: (Ok((ConsPattern(Record({"head": __match_val._field0[0], "tail": __match_val._field0[0]})), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Ok((__match_val._field0[0], __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0)))))(parseConsPattern(__let_val_68[1])))(__let_val_68[0]) if isinstance(__let_val_68, tuple) and len(__let_val_68) == 2 else None)(matchToken(__match_val._field0[1])([DOUBLE_COLON])))(parseAtomPattern(state))

def parseAtomPattern(state):
    return (lambda __let_val_78: (lambda __match_val: (Ok((IntPattern(getTokenInt(__match_val._field0)), __let_val_78[1])) if isinstance(__match_val, Just) else (lambda __let_val_77: (lambda __match_val: (Ok((FloatPattern(getTokenFloat(__match_val._field0)), __let_val_77[1])) if isinstance(__match_val, Just) else (lambda __let_val_76: (lambda __match_val: (Ok((StringPattern(getTokenString(__match_val._field0)), __let_val_76[1])) if isinstance(__match_val, Just) else (lambda __let_val_75: (lambda __match_val: (Ok((CharPattern(getTokenChar(__match_val._field0)), __let_val_75[1])) if isinstance(__match_val, Just) else (lambda __let_val_74: (lambda __match_val: (Ok((BoolPattern(True), __let_val_74[1])) if isinstance(__match_val, Just) else (lambda __let_val_73: (lambda __match_val: (Ok((BoolPattern(False), __let_val_73[1])) if isinstance(__match_val, Just) else (lambda __let_val_72: (lambda __match_val: (Ok((WildcardPattern, __let_val_72[1])) if isinstance(__match_val, Just) else (lambda __let_val_71: (lambda __match_val: Ok((ListPattern([]), advance(__let_val_71[1]))) if check(__let_val_71[1])([RBRACKET]) else (lambda __match_val: (lambda __match_val: (Ok((ListPattern(__match_val._field0[0]), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __let_val_70: (lambda __match_val: Ok((TuplePattern([]), advance(__let_val_70[1]))) if check(__let_val_70[1])([RPAREN]) else (lambda __match_val: (lambda __let_val_69: (lambda __match_val: (lambda __match_val: (lambda __match_val: (Ok((TuplePattern(__match_val._field0[0]), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (Ok((__match_val._field0[0], __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else (Err(__match_val._field0) if isinstance(__match_val, Err) else (Err(__match_val._field0) if isinstance(__match_val, Err) else (lambda __match_val: (Ok((VarPattern(getTokenString(__match_val._field0[0])), __match_val._field0[1])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(expect(state)(IDENT)('Expected pattern'))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')'"))))))(expect(__match_val._field0[1])(RPAREN)("Expected ')'")))(parsePatternTupleElements(__let_val_69[1])([__match_val._field0[0]])))(__let_val_69[0]) if isinstance(__let_val_69, tuple) and len(__let_val_69) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parsePattern(__let_val_70[1])))(__let_val_70[0]) if isinstance(__let_val_70, tuple) and len(__let_val_70) == 2 else None)(matchToken(state)([LPAREN]))))))(expect(__match_val._field0[1])(RBRACKET)("Expected ']'")))(parsePatternListElements(__let_val_71[1])([])))(__let_val_71[0]) if isinstance(__let_val_71, tuple) and len(__let_val_71) == 2 else None)(matchToken(state)([LBRACKET]))))(__let_val_72[0]) if isinstance(__let_val_72, tuple) and len(__let_val_72) == 2 else None)(matchToken(state)([UNDERSCORE]))))(__let_val_73[0]) if isinstance(__let_val_73, tuple) and len(__let_val_73) == 2 else None)(matchToken(state)([FALSE]))))(__let_val_74[0]) if isinstance(__let_val_74, tuple) and len(__let_val_74) == 2 else None)(matchToken(state)([TRUE]))))(__let_val_75[0]) if isinstance(__let_val_75, tuple) and len(__let_val_75) == 2 else None)(matchToken(state)([CHAR]))))(__let_val_76[0]) if isinstance(__let_val_76, tuple) and len(__let_val_76) == 2 else None)(matchToken(state)([STRING]))))(__let_val_77[0]) if isinstance(__let_val_77, tuple) and len(__let_val_77) == 2 else None)(matchToken(state)([FLOAT]))))(__let_val_78[0]) if isinstance(__let_val_78, tuple) and len(__let_val_78) == 2 else None)(matchToken(state)([INT]))

def parsePatternListElements(state): return lambda elements: (lambda __match_val: (lambda __let_val_79: (lambda __match_val: (parsePatternListElements(__let_val_79[1])(elements + [__match_val._field0[0]]) if isinstance(__match_val, Just) else (Ok((elements + [__match_val._field0[0]], __match_val._field0[1])) if __match_val is Nothing else Err(__match_val._field0))))(__let_val_79[0]) if isinstance(__let_val_79, tuple) and len(__let_val_79) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])))(parsePattern(state))

def parsePatternTupleElements(state): return lambda elements: Ok((elements, state)) if check(state)([RPAREN]) else (lambda __match_val: ((lambda __let_val_80: parsePatternTupleElements(__let_val_80[1])(elements + [__match_val._field0[0]]) if isinstance(__let_val_80, tuple) and len(__let_val_80) == 2 else None)(matchToken(__match_val._field0[1])([COMMA])) if isinstance(__match_val, Ok) and isinstance(__match_val._field0, tuple) and len(__match_val._field0) == 2 else Err(__match_val._field0)))(parsePattern(state))
